{"version":3,"file":"index.js","sources":["src/h.ts","src/index.tsx"],"sourcesContent":["\nconst h = function h(tagName: string, attributes, ...children: HTMLElement[]): HTMLElement {\n    const el = document.createElement(tagName)\n    attributes && Object.keys(attributes).map(k => {\n        const v = attributes[k]\n        if (v) {\n            switch (k) {\n                case 'htmlFor':\n                    el.setAttribute('for', v);\n                    break;\n                case 'style':\n                    Object.assign(el.style, v);\n                    break;\n                default:\n                    if (/^on/.test(k)) {\n                        el.addEventListener(k.substring(2).toLowerCase(), v)\n                    } else {\n                        el[k] = v\n                    }\n            }\n        }\n    })\n    children.map(c => {\n        if (c instanceof HTMLElement) {\n            el.appendChild(c)\n        } else {\n            el.innerHTML = c\n        }\n    })\n    return el\n}\n\nexport default h","import h from './h'\n\nconst NAME = 'image-crop-picker'\n\nconst cssText = `\n    .${NAME} {\n        margin: 0 auto;\n        width: 300px;\n    }\n    .${NAME} > label {\n        display: block;\n        padding: 2em;\n        margin: .5em 0;\n        border: 2px dashed;\n        border-radius: 7px;\n        cursor: pointer;\n        opacity: .8;\n    }\n    .${NAME} > label:hover {\n        opacity: 1;\n    }\n    .${NAME} > canvas {\n        display: block;\n        margin: 0 auto;\n    }\n`\nclass ImageCropPicker extends HTMLElement {\n    \n    getAllAttributes = () => [].slice.call(this.attributes).reduce((m, attr) => {\n        let { name, value } = attr\n        if (value) {\n            switch (attr.name) {\n                case 'maxSize':\n                case 'width':\n                case 'height':\n                    value = Number(value);\n                    break;\n            }\n            m[name] = value\n        }\n        return m\n    }, {})\n\n    constructor() {\n        super();\n        const t = this\n        const { className = '', title = '', innerText, dispatchEvent } = t\n        const { accept = 'image/*', maxSize = 102400, name = NAME, width = 300, height = 200 } = t.getAllAttributes()\n\n        const canvas: HTMLCanvasElement = <canvas tabIndex=\"-1\" width={width} height={height}></canvas>\n        const ctx = canvas.getContext('2d')\n\n        const preventDefault = (e:Event) => {\n            e.stopPropagation()\n            e.preventDefault()\n        }\n\n        let img\n        let zoom = 1\n        let position = {\n            x: 0,\n            y: 0\n        }\n        const drawImage = () => {\n            const { x, y } = position\n            const { width, height } = img\n            ctx.clearRect(0, 0, width, height)\n            ctx.drawImage(img, x, y, width, height, 0, 0, width * zoom, height * zoom)\n            canvas.toBlob(result => {\n                t['files'] = [result]\n                dispatchEvent(new CustomEvent('change'))\n            })\n        }\n        const onPickFile = function (e) {\n            const file = (e.target.files || e.dataTransfer.files)[0]\n            if (file.type.indexOf(accept.replace('*','')) === -1) {\n                alert(\"file type invalid!\");\n            }\n            const src = URL.createObjectURL(file)\n            img = new Image()\n            img.addEventListener('load', e => {\n                drawImage()\n            })\n            img.src = src\n            canvas.focus()\n            preventDefault(e)\n        }\n        \n        canvas.addEventListener('keydown', e => {\n            switch (e.keyCode) {\n                case 37: position.x++; break;\n                case 38: position.y++; break;\n                case 39: position.x--; break;\n                case 40: position.y--; break;\n                case 187: zoom += .05; break;\n                case 189: zoom -= .05; break;\n            }\n            drawImage()\n            preventDefault(e)\n        }, false)\n\n        let touchPosition = null\n        const touchStart = (e) => {\n            const ev = e.touches ? e.touches[0] : e\n            const { clientX, clientY } = ev\n            touchPosition = { clientX, clientY }\n        }\n        const touchMove = (e) => {\n            if (touchPosition) {\n                const ev = e.touches ? e.touches[0] : e\n                const { clientX, clientY } = ev\n                position.x += touchPosition.clientX - clientX\n                position.y += touchPosition.clientY - clientY\n                drawImage()\n                touchPosition = { clientX, clientY }\n            }\n        }\n        const touchEnd = (e) => {\n            touchPosition = null\n        }\n        canvas.addEventListener('touchstart', touchStart)\n        canvas.addEventListener('mousedown', touchStart)\n        canvas.addEventListener('touchmove', touchMove)\n        canvas.addEventListener('mousemove', touchMove)\n        canvas.addEventListener('touchend', touchEnd)\n        canvas.addEventListener('mouseup', touchEnd)\n\n        const label = <label onDragEnter={preventDefault} onDragOver={preventDefault} onDragEnd={preventDefault} onDrop={onPickFile}>\n            <input type=\"file\" accept={accept} name={name} style={{ display: 'none' }} onChange={onPickFile}/>\n            <span>{innerText.trim() || 'Click or Drop image file here'}</span>\n        </label>\n        \n        const root = this.attachShadow({\n            mode: 'open'\n        })\n        root.appendChild(<style>{cssText}</style>)\n        root.appendChild(<div className={`${NAME} ${className}`} title={title}>\n            {label}\n            {canvas}\n        </div>)\n    }\n\n}\n\ncustomElements.define(NAME, ImageCropPicker);\n"],"names":[],"mappings":"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"}